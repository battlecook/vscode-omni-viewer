var ImageViewer;(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,n(o.key),o)}}function n(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,"string");if("object"!=e(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var i=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.image=t,this.brightness=100,this.contrast=100,this.saturation=100,this.grayscale=0,this.imageEditMode=null,this.brightnessSlider=document.getElementById("brightnessSlider"),this.contrastSlider=document.getElementById("contrastSlider"),this.saturationSlider=document.getElementById("saturationSlider"),this.grayscaleSlider=document.getElementById("grayscaleSlider"),this.presetNormal=document.getElementById("presetNormal"),this.presetBright=document.getElementById("presetBright"),this.presetDark=document.getElementById("presetDark"),this.presetVintage=document.getElementById("presetVintage"),this.presetBw=document.getElementById("presetBw")},n=[{key:"setupEventListeners",value:function(){var e=this;this.brightnessSlider.addEventListener("input",function(t){e.brightness=parseInt(t.target.value),e.updateFilters()}),this.contrastSlider.addEventListener("input",function(t){e.contrast=parseInt(t.target.value),e.updateFilters()}),this.saturationSlider.addEventListener("input",function(t){e.saturation=parseInt(t.target.value),e.updateFilters()}),this.grayscaleSlider.addEventListener("input",function(t){e.grayscale=parseInt(t.target.value),e.updateFilters()}),this.presetNormal.addEventListener("click",function(){return e.applyPreset("normal")}),this.presetBright.addEventListener("click",function(){return e.applyPreset("bright")}),this.presetDark.addEventListener("click",function(){return e.applyPreset("dark")}),this.presetVintage.addEventListener("click",function(){return e.applyPreset("vintage")}),this.presetBw.addEventListener("click",function(){return e.applyPreset("bw")})}},{key:"updateFilters",value:function(){var e="brightness(".concat(this.brightness,"%) contrast(").concat(this.contrast,"%) saturate(").concat(this.saturation,"%) grayscale(").concat(this.grayscale,"%)");this.image.style.filter=e,this.imageEditMode&&this.imageEditMode.isEditMode&&(console.log("Updating edit canvas after filter change"),this.imageEditMode.setupEditCanvas())}},{key:"getFilterString",value:function(){return"brightness(".concat(this.brightness,"%) contrast(").concat(this.contrast,"%) saturate(").concat(this.saturation,"%) grayscale(").concat(this.grayscale,"%)")}},{key:"applyPreset",value:function(e){switch(document.querySelectorAll(".preset-btn").forEach(function(e){return e.classList.remove("active")}),e){case"normal":this.brightness=100,this.contrast=100,this.saturation=100,this.grayscale=0,this.presetNormal.classList.add("active");break;case"bright":this.brightness=130,this.contrast=110,this.saturation=100,this.grayscale=0,this.presetBright.classList.add("active");break;case"dark":this.brightness=70,this.contrast=120,this.saturation=100,this.grayscale=0,this.presetDark.classList.add("active");break;case"vintage":this.brightness=110,this.contrast=90,this.saturation=70,this.grayscale=10,this.presetVintage.classList.add("active");break;case"bw":this.brightness=100,this.contrast=120,this.saturation=0,this.grayscale=100,this.presetBw.classList.add("active")}this.brightnessSlider.value=this.brightness,this.contrastSlider.value=this.contrast,this.saturationSlider.value=this.saturation,this.grayscaleSlider.value=this.grayscale,this.updateFilters()}},{key:"resetFilters",value:function(){this.applyPreset("normal")}}],n&&t(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,n}();function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,a(i.key),i)}}function a(e){var t=function(e){if("object"!=o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=o(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:t+""}var l=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentTool="select",this.tools=["select","text","circle","rectangle"],this.addTextBtn=document.getElementById("addText"),this.addCircleBtn=document.getElementById("addCircle"),this.addRectangleBtn=document.getElementById("addRectangle"),this.selectToolBtn=document.getElementById("selectTool"),this.editCanvas=document.getElementById("editCanvas")},(t=[{key:"setTool",value:function(e){this.tools.includes(e)?(console.log("Setting tool to:",e),this.currentTool=e,this.updateButtonStates(),this.updateCanvasClass(),console.log("Tool set to:",this.currentTool),console.log("Button states updated")):console.warn("Unknown tool: ".concat(e))}},{key:"getCurrentTool",value:function(){return this.currentTool}},{key:"updateButtonStates",value:function(){var e=this,t=[{btn:this.addTextBtn,tool:"text"},{btn:this.addCircleBtn,tool:"circle"},{btn:this.addRectangleBtn,tool:"rectangle"},{btn:this.selectToolBtn,tool:"select"}];console.log("Updating button states for tool:",this.currentTool),t.forEach(function(t){var n=t.btn,i=t.tool;if(n){var o=i===e.currentTool;n.classList.toggle("active",o),console.log("Button ".concat(i,":"),n,"active:",o)}else console.warn("Button for tool ".concat(i," not found"))})}},{key:"updateCanvasClass",value:function(){this.editCanvas&&this.editCanvas.classList.toggle("select-mode","select"===this.currentTool)}},{key:"isSelectTool",value:function(){return"select"===this.currentTool}},{key:"isTextTool",value:function(){return"text"===this.currentTool}},{key:"isCircleTool",value:function(){return"circle"===this.currentTool}},{key:"isRectangleTool",value:function(){return"rectangle"===this.currentTool}},{key:"setupEventListeners",value:function(e){var t=this;[{btn:this.addTextBtn,tool:"text"},{btn:this.addCircleBtn,tool:"circle"},{btn:this.addRectangleBtn,tool:"rectangle"},{btn:this.selectToolBtn,tool:"select"}].forEach(function(n){var i=n.btn,o=n.tool;i&&i.addEventListener("click",function(){console.log("".concat(o," button clicked")),t.setTool(o),e&&e(o)})})}}])&&r(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,u(i.key),i)}}function u(e){var t=function(e){if("object"!=s(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==s(t)?t:t+""}var d=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"createTextElement",value:function(e){var t=document.createElement("div");return t.className="text-element",t.textContent=e.text,t.style.fontSize=e.fontSize+"px",t}},{key:"createShapeElement",value:function(e){var t=document.createElement("div");if(t.className="shape-element","circle"===e.type)t.style.width=e.size+"px",t.style.height=e.size+"px",t.style.borderRadius="50%";else if("rectangle"===e.type){var n=void 0!==e.width?e.width:e.size,i=void 0!==e.height?e.height:e.size;t.style.width=n+"px",t.style.height=i+"px"}return t}},{key:"setElementAttributes",value:function(e,t){e.setAttribute("data-element-id",t.id)}},{key:"appendToCanvas",value:function(e,t){e.appendChild(t)}},{key:"removeFromCanvas",value:function(e,t){t&&e.contains(t)&&e.removeChild(t)}},{key:"findElementById",value:function(e){return document.querySelector('[data-element-id="'.concat(e,'"]'))}},{key:"getBoundingRect",value:function(e){return e.getBoundingClientRect()}},{key:"isPointInElement",value:function(e,t,n,i){var o=e.getBoundingClientRect(),r=i.getBoundingClientRect();return t>=o.left-r.left&&t<=o.right-r.left&&n>=o.top-r.top&&n<=o.bottom-r.top}},{key:"addEventListener",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e&&"function"==typeof n&&e.addEventListener(t,n,i)}},{key:"setZIndex",value:function(e,t){e&&(e.style.zIndex=t.toString())}},{key:"setPosition",value:function(e,t,n){e&&(e.style.left=t+"px",e.style.top=n+"px")}},{key:"setSize",value:function(e,t,n){e&&(e.style.width=t+"px",e.style.height=n+"px")}}],null&&c(e.prototype,null),t&&c(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,y(i.key),i)}}function y(e){var t=function(e){if("object"!=f(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=f(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==f(t)?t:t+""}var m=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"hexToRgba",value:function(e,t){e=e.replace("#","");var n=parseInt(e.substr(0,2),16),i=parseInt(e.substr(2,2),16),o=parseInt(e.substr(4,2),16);return"rgba(".concat(n,", ").concat(i,", ").concat(o,", ").concat(t,")")}},{key:"handleTransparentColor",value:function(e){return"#00000000"===e||"rgba(0,0,0,0)"===e?"transparent":e}},{key:"isTransparent",value:function(e){return"transparent"===e||"#00000000"===e||"rgba(0,0,0,0)"===e}},{key:"getCommonColor",value:function(e){return 0===e.length?"#ff0000":1===e.length||e.every(function(t){return t===e[0]})?e[0]:"mixed"}}],null&&h(e.prototype,null),t&&h(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,g(i.key),i)}}function g(e){var t=function(e){if("object"!=p(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==p(t)?t:t+""}var b=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},t=[{key:"updateTextElementStyles",value:function(e,t){e.textContent=t.text,e.style.fontSize=t.fontSize+"px";var n=(void 0!==t.fillOpacity?t.fillOpacity:100)/100,i=m.hexToRgba(t.color,n);e.style.color=i}},{key:"updateCircleElementStyles",value:function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(e.style.width=t.size+"px",e.style.height=t.size+"px",e.style.borderRadius="50%");var n=(void 0!==t.fillOpacity?t.fillOpacity:100)/100,i=m.hexToRgba(t.color,n);e.style.backgroundColor=i;var o=(void 0!==t.borderOpacity?t.borderOpacity:100)/100,r=m.hexToRgba(t.borderColor||"#000000",o);e.style.borderColor=r}},{key:"updateRectangleElementStyles",value:function(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]){var n=void 0!==t.width?t.width:t.size,i=void 0!==t.height?t.height:t.size;e.style.width=n+"px",e.style.height=i+"px"}var o=(void 0!==t.fillOpacity?t.fillOpacity:100)/100,r=m.hexToRgba(t.color,o);e.style.backgroundColor=r;var a=(void 0!==t.borderOpacity?t.borderOpacity:100)/100,l=m.hexToRgba(t.borderColor||"#000000",a);e.style.borderColor=l}},{key:"updateElementStyles",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(t.type){case"text":this.updateTextElementStyles(e,t);break;case"circle":this.updateCircleElementStyles(e,t,n);break;case"rectangle":this.updateRectangleElementStyles(e,t,n)}}},{key:"setElementBaseStyles",value:function(e,t){e.style.position="absolute",e.style.left=t.x+"px",e.style.top=t.y+"px",e.style.zIndex="10000",e.style.pointerEvents="auto",e.style.cursor="move",e.style.userSelect="none",t.type,e.style.transform="translate(-50%, -50%)"}},{key:"applySelectedStyles",value:function(e){e.classList.add("selected")}},{key:"removeSelectedStyles",value:function(e){e.classList.remove("selected")}}],null&&v(e.prototype,null),t&&v(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function k(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,w(i.key),i)}}function w(e){var t=function(e){if("object"!=E(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==E(t)?t:t+""}var C=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editCanvas=t,this.elements=[],this.nextElementId=1},t=[{key:"createElement",value:function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=i.size||100,r={id:this.nextElementId++,type:e,x:t,y:n,color:i.color||"#ff0000",borderColor:i.borderColor||"#000000",fillOpacity:i.fillOpacity||100,borderOpacity:i.borderOpacity||100,size:o,width:o,height:o,text:i.text||"Text",fontSize:i.fontSize||24};return this.elements.push(r),r}},{key:"renderElement",value:function(e){var t;return console.log("renderElement called with:",e),t="text"===e.type?d.createTextElement(e):d.createShapeElement(e),b.setElementBaseStyles(t,e),b.updateElementStyles(t,e,!0),d.setElementAttributes(t,e),d.appendToCanvas(this.editCanvas,t),console.log("Element created:",t),t}},{key:"deleteElement",value:function(e){var t=d.findElementById(e.id);t&&d.removeFromCanvas(this.editCanvas,t),this.elements=this.elements.filter(function(t){return t.id!==e.id})}},{key:"deleteElements",value:function(e){var t=this;e.forEach(function(e){return t.deleteElement(e)})}},{key:"clearAllElements",value:function(){var e=this;this.elements.forEach(function(t){var n=d.findElementById(t.id);n&&d.removeFromCanvas(e.editCanvas,n)}),this.elements=[],this.nextElementId=1}},{key:"updateElement",value:function(e,t){Object.assign(e,t);var n=d.findElementById(e.id);if(n){var i=void 0!==t.size&&t.size!==e.size;b.updateElementStyles(n,e,i)}else console.log("Element not found, re-rendering"),this.renderElement(e)}},{key:"bringElementToFront",value:function(e){var t=this.elements.indexOf(e);t>-1&&this.elements.splice(t,1),this.elements.push(e),this.updateZIndexes()}},{key:"updateZIndexes",value:function(){this.elements.forEach(function(e,t){var n=d.findElementById(e.id);n&&d.setZIndex(n,1e4+t)})}},{key:"findElementAt",value:function(e,t){for(var n=this.elements.length-1;n>=0;n--){var i=this.elements[n],o=d.findElementById(i.id);if(o&&d.isPointInElement(o,e,t,this.editCanvas))return i}return null}},{key:"getAllElements",value:function(){return function(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.elements)}},{key:"getElementCount",value:function(){return this.elements.length}},{key:"getElementById",value:function(e){return this.elements.find(function(t){return t.id===e})}}],t&&k(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function M(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,z(i.key),i)}}function z(e){var t=function(e){if("object"!=I(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=I(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==I(t)?t:t+""}var P=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.selectedElements=[],this.selectionInfo=document.getElementById("selectionInfo")},t=[{key:"selectElement",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]?this.selectedElements.some(function(t){return t.id===e.id})?this.deselectElement(e):(this.selectedElements.push(e),this.applySelectionStyles(e)):(this.clearAllSelections(),this.selectedElements=[e],this.applySelectionStyles(e)),this.updateSelectionInfo()}},{key:"deselectElement",value:function(e){var t=d.findElementById(e.id);t&&(b.removeSelectedStyles(t),this.hideResizeHandles(t)),this.selectedElements=this.selectedElements.filter(function(t){return t.id!==e.id}),this.updateSelectionInfo()}},{key:"clearAllSelections",value:function(){var e=this;this.selectedElements.forEach(function(t){e.deselectElement(t)}),this.selectedElements=[],this.updateSelectionInfo()}},{key:"getSelectedElements",value:function(){return function(e){return function(e){if(Array.isArray(e))return x(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(this.selectedElements)}},{key:"getSelectedCount",value:function(){return this.selectedElements.length}},{key:"hasSelection",value:function(){return this.selectedElements.length>0}},{key:"getFirstSelected",value:function(){return this.selectedElements.length>0?this.selectedElements[0]:null}},{key:"applySelectionStyles",value:function(e){var t=d.findElementById(e.id);t&&(b.applySelectedStyles(t),"rectangle"===e.type&&this.showResizeHandles(t))}},{key:"showResizeHandles",value:function(e){e.querySelectorAll(".resize-handle").forEach(function(e){return e.style.display="block"})}},{key:"hideResizeHandles",value:function(e){e.querySelectorAll(".resize-handle").forEach(function(e){return e.style.display="none"})}},{key:"updateSelectionInfo",value:function(){if(this.selectionInfo){var e=this.selectedElements.length;e>0?(this.selectionInfo.textContent="".concat(e," selected"),this.selectionInfo.style.display="inline"):this.selectionInfo.style.display="none"}}},{key:"areAllSameType",value:function(){if(this.selectedElements.length<=1)return!0;var e=this.selectedElements[0].type;return this.selectedElements.every(function(t){return t.type===e})}},{key:"hasTextElements",value:function(){return this.selectedElements.some(function(e){return"text"===e.type})}},{key:"hasNonTextElements",value:function(){return this.selectedElements.some(function(e){return"text"!==e.type})}}],t&&M(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function L(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,O(i.key),i)}}function O(e){var t=function(e){if("object"!=B(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=B(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==B(t)?t:t+""}var T=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editProperties=document.getElementById("editProperties"),this.shapeColor=document.getElementById("shapeColor"),this.borderColor=document.getElementById("borderColor"),this.fillOpacity=document.getElementById("fillOpacity"),this.borderOpacity=document.getElementById("borderOpacity"),this.fillOpacityValue=document.getElementById("fillOpacityValue"),this.borderOpacityValue=document.getElementById("borderOpacityValue"),this.shapeSize=document.getElementById("shapeSize"),this.textInput=document.getElementById("textInput"),this.fontSize=document.getElementById("fontSize"),this.fontSizeInput=document.getElementById("fontSizeInput")},t=[{key:"show",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.editProperties&&(this.editProperties.style.display=e?"flex":"none")}},{key:"updateProperties",value:function(e){if(0!==e.length){this.updatePropertyGroups(e);var t=this.calculateCommonProperties(e);this.updatePropertyValues(t),this.show(!0)}else this.show(!1)}},{key:"updatePropertyGroups",value:function(e){this.editProperties.querySelectorAll(".property-group").forEach(function(t){var n=t.querySelector('input[type="color"][id="shapeColor"]'),i=t.querySelector('input[type="color"][id="borderColor"]'),o=t.querySelector('input[type="range"][id="borderOpacity"]'),r=t.querySelector('input[type="text"]'),a=t.querySelector('input[type="range"][id="fontSize"]');if(n)t.style.display="flex";else if(i||o){var l=e.some(function(e){return"text"===e.type}),s=e.some(function(e){return"text"!==e.type});t.style.display=s||l&&s?"flex":"none"}else if(r||a){var c=e.some(function(e){return"text"===e.type});t.style.display=c?"flex":"none"}})}},{key:"calculateCommonProperties",value:function(e){if(1===e.length){var t=e[0];return{color:t.color,borderColor:t.borderColor||"#000000",fillOpacity:void 0!==t.fillOpacity?t.fillOpacity:100,borderOpacity:void 0!==t.borderOpacity?t.borderOpacity:100,size:t.size,text:t.text||"",fontSize:t.fontSize||24}}var n=e.map(function(e){return e.color}),i=e.map(function(e){return e.borderColor||"#000000"}),o=e.map(function(e){return void 0!==e.fillOpacity?e.fillOpacity:100}),r=e.map(function(e){return void 0!==e.borderOpacity?e.borderOpacity:100}),a=e.map(function(e){return e.size}),l=e.map(function(e){return e.text||""}),s=e.map(function(e){return e.fontSize||24});return{color:m.getCommonColor(n),borderColor:m.getCommonColor(i),fillOpacity:this.getCommonValue(o),borderOpacity:this.getCommonValue(r),size:this.getCommonValue(a),text:this.getCommonText(l),fontSize:this.getCommonValue(s)}}},{key:"getCommonValue",value:function(e){return 0===e.length?0:1===e.length||e.every(function(t){return t===e[0]})?e[0]:Math.round(e.reduce(function(e,t){return e+t},0)/e.length)}},{key:"getCommonText",value:function(e){return 0===e.length?"":1===e.length||e.every(function(t){return t===e[0]})?e[0]:"mixed"}},{key:"updatePropertyValues",value:function(e){this.shapeColor&&(this.shapeColor.value="mixed"===e.color?"#ff0000":e.color),this.borderColor&&(this.borderColor.value="mixed"===e.borderColor?"#000000":e.borderColor),this.fillOpacity&&(this.fillOpacity.value=e.fillOpacity,this.fillOpacityValue&&(this.fillOpacityValue.textContent=e.fillOpacity+"%")),this.borderOpacity&&(this.borderOpacity.value=e.borderOpacity,this.borderOpacityValue&&(this.borderOpacityValue.textContent=e.borderOpacity+"%")),this.shapeSize&&(this.shapeSize.value=e.size),this.textInput&&(this.textInput.value="mixed"===e.text?"":e.text),this.fontSize&&(this.fontSize.value=e.fontSize,this.fontSizeInput&&(this.fontSizeInput.value=e.fontSize))}},{key:"getCurrentProperties",value:function(){return{color:this.shapeColor?this.shapeColor.value:"#ff0000",borderColor:this.borderColor?this.borderColor.value:"#000000",fillOpacity:this.fillOpacity?parseInt(this.fillOpacity.value):100,borderOpacity:this.borderOpacity?parseInt(this.borderOpacity.value):100,size:this.shapeSize?parseInt(this.shapeSize.value):100,text:this.textInput?this.textInput.value:"",fontSize:this.fontSize?parseInt(this.fontSize.value):24}}},{key:"setupEventListeners",value:function(e){var t=this;[this.shapeColor,this.borderColor,this.fillOpacity,this.borderOpacity,this.shapeSize,this.textInput,this.fontSize,this.fontSizeInput].forEach(function(n){if(n){var i="range"===n.type?"input":"change";n.addEventListener(i,function(i){n===t.fillOpacity&&t.fillOpacityValue&&(t.fillOpacityValue.textContent=i.target.value+"%"),n===t.borderOpacity&&t.borderOpacityValue&&(t.borderOpacityValue.textContent=i.target.value+"%"),n===t.fontSize&&t.fontSizeInput&&(t.fontSizeInput.value=i.target.value),n===t.fontSizeInput&&t.fontSize&&(t.fontSize.value=i.target.value),e&&e()})}})}}],t&&L(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,R(i.key),i)}}function R(e){var t=function(e){if("object"!=A(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=A(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==A(t)?t:t+""}var D=function(){return e=function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.editCanvas=t,this.elementManager=n,this.selectionManager=i,this.isDragging=!1,this.startX=0,this.startY=0,this.initialPositions=[]},t=[{key:"makeElementDraggable",value:function(e,t){var n=this;d.addEventListener(e,"mousedown",function(e){n.selectionManager.getSelectedElements().some(function(e){return e.id===t.id})&&n.startDragging(e,t)}),d.addEventListener(document,"mousemove",function(e){n.handleMouseMove(e)}),d.addEventListener(document,"mouseup",function(){n.stopDragging()})}},{key:"startDragging",value:function(e,t){this.isDragging=!0,this.startX=e.clientX-t.x,this.startY=e.clientY-t.y;var n=this.selectionManager.getSelectedElements();n.length>1&&(this.initialPositions=n.map(function(e){return{id:e.id,x:e.x,y:e.y}})),e.stopPropagation()}},{key:"handleMouseMove",value:function(e){if(this.isDragging){var t=this.selectionManager.getSelectedElements();if(0!==t.length){var n=e.clientX-this.startX-t[0].x,i=e.clientY-this.startY-t[0].y;t.length>1?this.moveMultipleElements(t,n,i):this.moveSingleElement(t[0],e)}}}},{key:"moveSingleElement",value:function(e,t){e.x=t.clientX-this.startX,e.y=t.clientY-this.startY;var n=d.findElementById(e.id);n&&d.setPosition(n,e.x,e.y)}},{key:"moveMultipleElements",value:function(e,t,n){var i=this;e.forEach(function(e){var o=i.initialPositions.find(function(t){return t.id===e.id});if(o){e.x=o.x+t,e.y=o.y+n;var r=d.findElementById(e.id);r&&d.setPosition(r,e.x,e.y)}})}},{key:"stopDragging",value:function(){this.isDragging=!1,this.initialPositions=[]}},{key:"makeTextEditable",value:function(e,t){e.classList.add("editing");var n=document.createElement("input");n.type="text",n.value=t.text,n.style.fontSize=t.fontSize+"px",n.style.color=t.color,n.addEventListener("blur",function(){t.text=n.value,e.textContent=n.value,e.classList.remove("editing"),e.removeChild(n)}),n.addEventListener("keydown",function(e){"Enter"===e.key&&n.blur()}),e.textContent="",e.appendChild(n),n.focus(),n.select()}},{key:"isDraggingActive",value:function(){return this.isDragging}}],t&&j(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function H(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,V(i.key),i)}}function V(e){var t=function(e){if("object"!=F(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=F(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==F(t)?t:t+""}var W=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isResizing=!1,this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.startElementX=0,this.startElementY=0,this.currentElement=null,this.currentHandle=null},t=[{key:"addResizeHandles",value:function(e,t){var n=this;["top-left","top-right","bottom-left","bottom-right"].forEach(function(i){var o=document.createElement("div");o.className="resize-handle ".concat(i),o.setAttribute("data-handle-type",i),o.style.display="none",e.appendChild(o),n.makeHandleResizable(o,e,t,i)})}},{key:"makeHandleResizable",value:function(e,t,n,i){var o=this;d.addEventListener(e,"mousedown",function(e){o.startResizing(e,n,i)}),d.addEventListener(document,"mousemove",function(e){o.handleResizeMove(e)}),d.addEventListener(document,"mouseup",function(){o.stopResizing()})}},{key:"startResizing",value:function(e,t,n){this.isResizing=!0,this.startX=e.clientX,this.startY=e.clientY;var i=d.findElementById(t.id);if(i){var o=i.getBoundingClientRect();this.startWidth=o.width,this.startHeight=o.height}else this.startWidth=t.size,this.startHeight=t.size;this.startElementX=t.x,this.startElementY=t.y,this.currentElement=t,this.currentHandle=n,console.log("Resize started:",{startWidth:this.startWidth,startHeight:this.startHeight,elementSize:t.size}),e.stopPropagation()}},{key:"handleResizeMove",value:function(e){if(this.isResizing&&this.currentElement){var t=e.clientX-this.startX,n=e.clientY-this.startY,i=this.calculateNewSizeAndPosition(t,n,this.currentHandle),o=i.newWidth,r=i.newHeight,a=i.newX,l=i.newY;this.currentElement.x=a,this.currentElement.y=l,"rectangle"===this.currentElement.type?(this.currentElement.width=o,this.currentElement.height=r,this.currentElement.size=o):this.currentElement.size=o;var s=d.findElementById(this.currentElement.id);s&&(d.setSize(s,o,r),d.setPosition(s,a,l)),console.log("Resize update:",{newWidth:o,newHeight:r,elementSize:this.currentElement.size})}}},{key:"calculateNewSizeAndPosition",value:function(e,t,n){var i=this.startWidth,o=this.startHeight,r=this.startElementX,a=this.startElementY,l=20;switch(n){case"bottom-right":i=Math.max(l,this.startWidth+e),o=Math.max(l,this.startHeight+t);break;case"bottom-left":i=Math.max(l,this.startWidth-e),o=Math.max(l,this.startHeight+t),r=this.startElementX+(this.startWidth-i);break;case"top-right":i=Math.max(l,this.startWidth+e),o=Math.max(l,this.startHeight-t),a=this.startElementY+(this.startHeight-o);break;case"top-left":i=Math.max(l,this.startWidth-e),o=Math.max(l,this.startHeight-t),r=this.startElementX+(this.startWidth-i),a=this.startElementY+(this.startHeight-o)}return{newWidth:i,newHeight:o,newX:r,newY:a}}},{key:"stopResizing",value:function(){this.isResizing=!1,this.currentElement=null,this.currentHandle=null}},{key:"showResizeHandles",value:function(e){e.querySelectorAll(".resize-handle").forEach(function(e){return e.style.display="block"})}},{key:"hideResizeHandles",value:function(e){e.querySelectorAll(".resize-handle").forEach(function(e){return e.style.display="none"})}},{key:"isResizingActive",value:function(){return this.isResizing}}],t&&H(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function Y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,X(i.key),i)}}function X(e){var t=function(e){if("object"!=N(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=N(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==N(t)?t:t+""}var q=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isEditMode=!1},t=[{key:"setEditMode",value:function(e){this.isEditMode=e}},{key:"handleKeyDown",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.isEditMode&&("Delete"!==e.key&&"Backspace"!==e.key||(e.preventDefault(),t.onDelete&&t.onDelete()),"Escape"===e.key&&t.onEscape&&t.onEscape())}},{key:"handleCanvasClick",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.isEditMode){var n=e.currentTarget.getBoundingClientRect(),i=e.clientX-n.left,o=e.clientY-n.top;if(!(i<0||i>n.width||o<0||o>n.height)){var r=e.metaKey||e.ctrlKey;t.onCanvasClick&&t.onCanvasClick(i,o,r)}}else t.onLogMessage&&t.onLogMessage("Edit mode not active")}},{key:"setupKeyboardListeners",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};document.addEventListener("keydown",function(n){e.handleKeyDown(n,t)})}},{key:"setupCanvasListeners",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e&&e.addEventListener("click",function(e){t.handleCanvasClick(e,n)})}},{key:"setupDeleteButtonListener",value:function(e,t){e&&t&&e.addEventListener("click",t)}},{key:"setupEditModeToggleListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e&&t&&e.addEventListener("click",function(){var i="none"!==t.style.display;t.style.display=i?"none":"flex",e.classList.toggle("active",!i),i?n.onDisableEditMode&&n.onDisableEditMode():n.onEnableEditMode&&n.onEnableEditMode()})}}],t&&Y(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function K(e){return K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K(e)}function U(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,_(i.key),i)}}function _(e){var t=function(e){if("object"!=K(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=K(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==K(t)?t:t+""}var Z=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.image=t,this.imageWrapper=n,this.isEditMode=!1,this.toggleEditModeBtn=document.getElementById("toggleEditMode"),this.editControls=document.getElementById("editControls"),this.editCanvas=document.getElementById("editCanvas"),this.deleteSelectedBtn=document.getElementById("deleteSelected"),this.toolManager=new l,this.elementManager=new C(this.editCanvas),this.selectionManager=new P,this.propertiesPanel=new T,this.dragDropManager=new D(this.editCanvas,this.elementManager,this.selectionManager),this.resizeManager=new W,this.eventManager=new q,this.onLogMessage=null},t=[{key:"setupEventListeners",value:function(){var e=this;console.log("Setting up edit mode event listeners..."),this.toolManager.setupEventListeners(function(t){e.onLogMessage&&e.onLogMessage("".concat(t," tool selected"))}),this.propertiesPanel.setupEventListeners(function(){e.updateSelectedElements()}),this.eventManager.setupKeyboardListeners({onDelete:function(){return e.deleteSelectedElements()},onEscape:function(){return e.clearAllSelections()}}),this.eventManager.setupCanvasListeners(this.editCanvas,{onCanvasClick:function(t,n,i){return e.handleCanvasClick(t,n,i)},onLogMessage:function(t){e.onLogMessage&&e.onLogMessage(t)}}),this.eventManager.setupDeleteButtonListener(this.deleteSelectedBtn,function(){e.deleteSelectedElements()}),this.eventManager.setupEditModeToggleListener(this.toggleEditModeBtn,this.editControls,{onEnableEditMode:function(){return e.enableEditMode()},onDisableEditMode:function(){return e.disableEditMode()}}),console.log("Edit mode event listeners setup complete")}},{key:"setupEditCanvas",value:function(){var e=this;setTimeout(function(){var t=e.image.getBoundingClientRect(),n=e.imageWrapper.getBoundingClientRect();console.log("Image rect:",t),console.log("Wrapper rect:",n);var i=t.width,o=t.height;e.editCanvas.style.width=i+"px",e.editCanvas.style.height=o+"px",e.editCanvas.style.left=t.left-n.left+"px",e.editCanvas.style.top=t.top-n.top+"px",e.onLogMessage&&e.onLogMessage("Canvas setup: ".concat(i,"x").concat(o," at (").concat(t.left-n.left,", ").concat(t.top-n.top,")")),e.elementManager.getAllElements().forEach(function(t){e.elementManager.renderElement(t)}),e.editCanvas.style.pointerEvents="auto",e.editCanvas.style.zIndex="9999",console.log("Canvas final setup:",{styleWidth:e.editCanvas.style.width,styleHeight:e.editCanvas.style.height,styleLeft:e.editCanvas.style.left,styleTop:e.editCanvas.style.top})},100)}},{key:"handleCanvasClick",value:function(e,t,n){if(!this.isEditMode)return console.log("Edit mode not active"),void(this.onLogMessage&&this.onLogMessage("Edit mode not active"));console.log("Canvas click: (".concat(e,", ").concat(t,"), tool: ").concat(this.toolManager.getCurrentTool())),this.toolManager.isSelectTool()?this.selectElementAt(e,t,n):this.addElementAt(e,t)}},{key:"addElementAt",value:function(e,t){var n=this;console.log("addElementAt called with:",e,t,this.toolManager.getCurrentTool());var i=this.propertiesPanel.getCurrentProperties(),o=this.elementManager.createElement(this.toolManager.getCurrentTool(),e,t,i);console.log("Created element:",o);var r=this.elementManager.renderElement(o);this.dragDropManager.makeElementDraggable(r,o),"rectangle"===o.type&&this.resizeManager.addResizeHandles(r,o),"text"===o.type&&r.addEventListener("dblclick",function(e){n.toolManager.isSelectTool()&&(n.dragDropManager.makeTextEditable(r,o),e.stopPropagation())}),this.selectionManager.selectElement(o,!1),this.propertiesPanel.updateProperties(this.selectionManager.getSelectedElements()),this.toolManager.setTool("select"),this.onLogMessage&&this.onLogMessage("Added ".concat(o.type," element at (").concat(e,", ").concat(t,"), total elements: ").concat(this.elementManager.getElementCount()))}},{key:"selectElementAt",value:function(e,t,n){console.log("selectElementAt called with:",e,t,"multiSelect:",n);var i=this.elementManager.findElementAt(e,t);i?(this.selectionManager.selectElement(i,n),this.elementManager.bringElementToFront(i),this.propertiesPanel.updateProperties(this.selectionManager.getSelectedElements()),this.onLogMessage&&this.onLogMessage("Selected ".concat(i.type," element (").concat(this.selectionManager.getSelectedCount()," total selected)"))):n||this.clearAllSelections()}},{key:"updateSelectedElements",value:function(){var e=this;console.log("updateSelectedElements called");var t=this.selectionManager.getSelectedElements();if(0!==t.length){var n=this.propertiesPanel.getCurrentProperties();t.forEach(function(t){e.elementManager.updateElement(t,n)}),this.onLogMessage&&this.onLogMessage("Updated ".concat(t.length," element(s)"))}else console.log("No selected elements")}},{key:"deleteSelectedElements",value:function(){var e=this.selectionManager.getSelectedElements();0!==e.length&&(this.elementManager.deleteElements(e),this.selectionManager.clearAllSelections(),this.propertiesPanel.show(!1),this.onLogMessage&&this.onLogMessage("".concat(e.length," element(s) deleted")))}},{key:"clearAllSelections",value:function(){this.selectionManager.clearAllSelections(),this.propertiesPanel.show(!1)}},{key:"enableEditMode",value:function(){console.log("enableEditMode called"),this.isEditMode=!0,this.eventManager.setEditMode(!0),this.editCanvas.classList.add("active"),console.log("Edit mode state:",this.isEditMode),console.log("Canvas class list:",this.editCanvas.classList.toString()),this.elementManager.clearAllElements(),this.selectionManager.clearAllSelections(),this.editCanvas.innerHTML="",this.setupEditCanvas(),this.toolManager.setTool("select"),this.onLogMessage&&this.onLogMessage("Edit mode enabled"),console.log("Edit mode enabled successfully")}},{key:"disableEditMode",value:function(){this.isEditMode=!1,this.eventManager.setEditMode(!1),this.editCanvas.classList.remove("active"),this.selectionManager.clearAllSelections(),this.propertiesPanel.show(!1),this.onLogMessage&&this.onLogMessage("Edit mode disabled")}},{key:"getAllElements",value:function(){return this.elementManager.getAllElements()}}],t&&U(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function G(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,J(i.key),i)}}function J(e){var t=function(e){if("object"!=$(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=$(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==$(t)?t:t+""}var Q=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},(t=[{key:"handleTransparentColor",value:function(e){return"#00000000"===e||"rgba(0,0,0,0)"===e?"transparent":e}},{key:"hexToRgba",value:function(e,t){e=e.replace("#","");var n=parseInt(e.substr(0,2),16),i=parseInt(e.substr(2,2),16),o=parseInt(e.substr(4,2),16);return"rgba(".concat(n,", ").concat(i,", ").concat(o,", ").concat(t,")")}},{key:"validateFilename",value:function(e,t){return e.toLowerCase().endsWith(t.toLowerCase())?/[<>:"/\\|?*]/.test(e)?"Filename contains invalid characters":null:"Filename should end with ".concat(t)}},{key:"generateDefaultFilename",value:function(e){var t=e.substring(0,e.lastIndexOf(".")),n=e.substring(e.lastIndexOf(".")),i=(new Date).toISOString().replace(/[:.]/g,"-").slice(0,19);return"".concat(t,"_saved_").concat(i).concat(n)}},{key:"getWorkspacePath",value:function(){return"{{workspacePath}}"}},{key:"getFileName",value:function(){return"{{fileName}}"}},{key:"getFileSize",value:function(){return"{{fileSize}}"}}])&&G(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function ee(e){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(e)}function te(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,ne(i.key),i)}}function ne(e){var t=function(e){if("object"!=ee(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=ee(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ee(t)?t:t+""}var ie=function(){return e=function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.image=t,this.vscode=n,this.imageFilters=i,this.filenameModal=document.getElementById("filenameModal"),this.filenameInput=document.getElementById("filenameInput"),this.cancelSaveBtn=document.getElementById("cancelSave"),this.confirmSaveBtn=document.getElementById("confirmSave"),this.currentPathSpan=document.getElementById("currentPath"),this.setupModalEventListeners()},t=[{key:"setupModalEventListeners",value:function(){var e=this;this.cancelSaveBtn.addEventListener("click",function(){e.filenameModal.style.display="none",e.filenameInput.value=""}),this.confirmSaveBtn.addEventListener("click",function(){var t=e.filenameInput.value.trim();t&&(e.filenameModal.style.display="none",e.saveFilteredImageWithName(t))}),this.filenameModal.addEventListener("click",function(t){t.target===e.filenameModal&&(e.filenameModal.style.display="none",e.filenameInput.value="")}),this.filenameInput.addEventListener("keydown",function(t){"Enter"===t.key?e.confirmSaveBtn.click():"Escape"===t.key&&e.cancelSaveBtn.click()}),this.filenameInput.addEventListener("input",function(){return e.updateSavePath()})}},{key:"saveFilteredImage",value:function(e,t,n,i,o,r){var a="{{fileName}}",l=a.substring(0,a.lastIndexOf(".")),s=a.substring(a.lastIndexOf(".")),c=(new Date).toISOString().replace(/[:.]/g,"-").slice(0,19),u="".concat(l,"_saved_").concat(c).concat(s);this.currentRotation=n,this.isFlippedHorizontal=i,this.isFlippedVertical=o,this.filterString=r,this.filenameInput.value=u,this.filenameInput.focus(),this.filenameInput.select(),this.filenameModal.style.display="flex",this.updateSavePath()}},{key:"updateSavePath",value:function(){var e=this.filenameInput.value.trim()||"filename.png",t="{{workspacePath}}";this.currentPathSpan.textContent=t?"".concat(t,"/").concat(e):"[Workspace folder]/".concat(e)}},{key:"updatePathFromVSCode",value:function(e){this.currentPathSpan.textContent=e}},{key:"saveFilteredImageWithName",value:function(e){var t=this,n="{{fileName}}",i=n.substring(n.lastIndexOf("."));if(e.toLowerCase().endsWith(i.toLowerCase()))if(/[<>:"/\\|?*]/.test(e))alert("Filename contains invalid characters");else{var o=document.createElement("canvas"),r=o.getContext("2d");o.width=this.image.naturalWidth,o.height=this.image.naturalHeight,r.filter=this.filterString||(this.imageFilters?this.imageFilters.getFilterString():""),r.save(),r.translate(o.width/2,o.height/2),r.rotate((this.currentRotation||0)*Math.PI/180);var a=this.isFlippedHorizontal?-1:1,l=this.isFlippedVertical?-1:1;r.scale(a,l),r.drawImage(this.image,-this.image.naturalWidth/2,-this.image.naturalHeight/2,this.image.naturalWidth,this.image.naturalHeight),r.restore(),o.toBlob(function(n){if(n){var i=new FileReader;i.onload=function(){var n=i.result.split(",")[1];t.vscode.postMessage({command:"saveFilteredImage",fileName:e,imageData:n}),t.vscode.postMessage({command:"log",text:"Filtered image saved as ".concat(e)})},i.readAsDataURL(n)}else t.vscode.postMessage({command:"error",text:"Failed to create filtered image"})},"image/png",.9)}else alert("Filename should end with ".concat(i))}},{key:"saveEditedImage",value:function(e,t,n,i,o,r,a){var l=this,s=document.createElement("canvas"),c=s.getContext("2d");s.width=t,s.height=n,c.filter=a,c.save(),c.translate(s.width/2,s.height/2),c.rotate(i*Math.PI/180);var u=o?-1:1,d=r?-1:1;c.scale(u,d),c.drawImage(this.image,-t/2,-n/2,t,n),c.restore();var f=document.getElementById("editCanvas").getBoundingClientRect(),h=s.width/f.width,y=s.height/f.height;e.forEach(function(e){if(console.log("Saving element:",e),c.save(),c.translate(e.x*h,e.y*y),"text"===e.type)c.font="".concat(e.fontSize*h,"px Arial"),c.fillStyle=e.color,c.textAlign="center",c.textBaseline="middle",c.fillText(e.text,0,0);else if("circle"===e.type)c.fillStyle=e.color,c.beginPath(),c.arc(0,0,e.size*h/2,0,2*Math.PI),c.fill();else if("rectangle"===e.type){c.fillStyle=e.color;var t=void 0!==e.width?e.width:e.size,n=void 0!==e.height?e.height:e.size;c.fillRect(-t*h/2,-n*y/2,t*h,n*y)}c.restore()}),s.toBlob(function(e){if(e){var t=new FileReader;t.onload=function(){var e=t.result.split(",")[1],n="{{fileName}}".replace(/\.[^/.]+$/,"_saved.png");l.vscode.postMessage({command:"saveFilteredImage",fileName:n,imageData:e}),l.vscode.postMessage({command:"log",text:"Edited image saved as ".concat(n)})},t.readAsDataURL(e)}else l.vscode.postMessage({command:"error",text:"Failed to create edited image"})},"image/png",.9)}}],t&&te(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();console.log("Image viewer script loading...");var oe=acquireVsCodeApi();console.log("VSCode API acquired");var re=100,ae=0,le=!1,se=!1,ce=0,ue=0,de="",fe="",he=document.getElementById("image"),ye=document.getElementById("imageWrapper"),me=document.getElementById("loading"),pe=document.getElementById("error"),ve=document.getElementById("fileInfo"),ge=document.getElementById("sizeInfo"),be=document.getElementById("formatInfo"),Ee=document.getElementById("fileSizeInfo"),Se=document.getElementById("zoomIn"),ke=document.getElementById("zoomOut"),we=document.getElementById("rotate"),Ce=document.getElementById("flipHorizontal"),Ie=document.getElementById("flipVertical"),xe=document.getElementById("reset"),Me=document.getElementById("fitToScreen"),ze=document.getElementById("saveFiltered"),Pe=new i(he),Be=new Z(he,ye),Le=(new Q,new ie(he,oe,Pe));function Oe(){Te()}function Te(){var e=re/100,t=ae,n=le?-1:1,i=se?-1:1;he.style.transform="scale(".concat(e*n,", ").concat(e*i,") rotate(").concat(t,"deg)"),Be.isEditMode&&Be.setupEditCanvas()}function Ae(){ge.textContent="".concat(ce,"").concat(ue),be.textContent=de,Ee.textContent=fe}function je(){var e=ye.parentElement,t=e.clientWidth-40,n=e.clientHeight-40,i=t/ce,o=n/ue,r=Math.min(i,o,1);re=Math.round(100*r),Oe(),Ae()}Pe.imageEditMode=Be,Be.onLogMessage=function(e){oe.postMessage({command:"log",text:e})},document.addEventListener("DOMContentLoaded",function(){console.log("DOM Content Loaded"),console.log("Initializing image viewer..."),Se.addEventListener("click",function(){re=Math.min(500,re+25),Oe()}),ke.addEventListener("click",function(){re=Math.max(10,re-25),Oe()}),ye.addEventListener("wheel",function(e){e.preventDefault();var t=e.deltaY>0?-1:1,n=e.ctrlKey?10:25;re=Math.max(10,Math.min(500,re+t*n)),Oe()}),we.addEventListener("click",function(){ae=(ae+90)%360,Te()}),Ce.addEventListener("click",function(){le=!le,Te()}),Ie.addEventListener("click",function(){se=!se,Te()}),xe.addEventListener("click",function(){re=100,ae=0,le=!1,se=!1,Oe(),Ae(),Pe.resetFilters()}),Me.addEventListener("click",function(){je()}),ze.addEventListener("click",function(){var e=Be.getAllElements();e.length>0?Le.saveEditedImage(e,ce,ue,ae,le,se,Pe.getFilterString()):Le.saveFilteredImage(ce,ue,ae,le,se,Pe.getFilterString())}),Pe.setupEventListeners(),document.addEventListener("keydown",function(e){switch(e.key){case"+":case"=":e.preventDefault(),Se.click();break;case"-":e.preventDefault(),ke.click();break;case"0":e.preventDefault(),xe.click();break;case"f":e.preventDefault(),Me.click();break;case"ArrowLeft":case"ArrowRight":e.preventDefault(),we.click();break;case"s":(e.ctrlKey||e.metaKey)&&(e.preventDefault(),ze.click())}}),Be.setupEventListeners(),console.log("Event listeners setup complete"),he.onload=function(){ce=he.naturalWidth,ue=he.naturalHeight;var e="{{fileName}}".split(".").pop().toUpperCase();de=e,fe="{{fileSize}}",me.style.display="none",ye.style.display="block",ve.style.display="flex",Ae(),je(),setTimeout(function(){Be.setupEditCanvas()},200),oe.postMessage({command:"log",text:"Image loaded successfully"})},he.onerror=function(){me.style.display="none",pe.style.display="block",pe.textContent="Error loading image file",oe.postMessage({command:"error",text:"Failed to load image"})}}),oe.postMessage({command:"log",text:"Image viewer initialized"}),ImageViewer={}})();