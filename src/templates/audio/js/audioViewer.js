/*! For license information please see audioViewer.js.LICENSE.txt */
var AudioViewer;(()=>{"use strict";var e={formatTime:function(e){var t=Math.floor(e/60),n=Math.floor(e%60),r=Math.floor(e%1*1e3);return"".concat(t,":").concat(n.toString().padStart(2,"0"),".").concat(r.toString().padStart(3,"0"))},showStatus:function(e,t){t&&(t.textContent=e,t.classList.add("show"),setTimeout(function(){t.classList.remove("show")},100))},log:function(e){"undefined"!=typeof vscode&&vscode.env&&1===vscode.env.uiKind&&console.log(e)}};function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t(e)}function n(){var e,t,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function s(n,o,a,i){var s=o&&o.prototype instanceof l?o:l,c=Object.create(s.prototype);return r(c,"_invoke",function(n,r,o){var a,i,s,l=0,c=o||[],f=!1,g={p:0,n:0,v:e,a:v,f:v.bind(e,4),d:function(t,n){return a=t,i=0,s=e,g.n=n,u}};function v(n,r){for(i=n,s=r,t=0;!f&&l&&!o&&t<c.length;t++){var o,a=c[t],v=g.p,p=a[2];n>3?(o=p===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=v&&((o=n<2&&v<a[1])?(i=0,g.v=r,g.n=a[1]):v<p&&(o=n<3||a[0]>r||r>p)&&(a[4]=n,a[5]=r,g.n=p,i=0))}if(o||n>1)return u;throw f=!0,r}return function(o,c,p){if(l>1)throw TypeError("Generator is already running");for(f&&1===c&&v(c,p),i=c,s=p;(t=i<2?e:s)||!f;){a||(i?i<3?(i>1&&(g.n=-1),v(i,s)):g.n=s:g.v=s);try{if(l=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,s)))throw TypeError("iterator result is not an object");if(!t.done)return t;s=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(f=g.n<0)?s:n.call(r,g))!==u)break}catch(t){a=e,i=1,s=t}finally{l=1}}return{value:t,done:f}}}(n,a,i),!0),c}var u={};function l(){}function c(){}function f(){}t=Object.getPrototypeOf;var g=[][a]?t(t([][a]())):(r(t={},a,function(){return this}),t),v=f.prototype=l.prototype=Object.create(g);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,r(e,i,"GeneratorFunction")),e.prototype=Object.create(v),e}return c.prototype=f,r(v,"constructor",f),r(f,"constructor",c),c.displayName="GeneratorFunction",r(f,i,"GeneratorFunction"),r(v),r(v,i,"Generator"),r(v,a,function(){return this}),r(v,"toString",function(){return"[object Generator]"}),(n=function(){return{w:s,m:p}})()}function r(e,t,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}r=function(e,t,n,o){function i(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},r(e,t,n,o)}function o(e,t,n,r,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function i(e){var n=function(e){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=t(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==t(n)?n:n+""}var s=function(){return t=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state=t},r=[{key:"initialize",value:(i=n().m(function t(){var r,o,a;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.state.audioContextInitialized){t.n=1;break}return t.a(2);case 1:if(t.p=1,"suspended"!==(r=new(window.AudioContext||window.webkitAudioContext)).state){t.n=2;break}return t.n=2,r.resume();case 2:this.state.audioContextInitialized=!0,t.n=4;break;case 3:t.p=3,a=t.v,console.error("Failed to initialize AudioContext:",a),e.showStatus("AudioContext initialization failed: "+a.message,null===(o=this.state.elements)||void 0===o?void 0:o.status);case 4:return t.a(2)}},t,this,[[1,3]])}),s=function(){var e=this,t=arguments;return new Promise(function(n,r){var a=i.apply(e,t);function s(e){o(a,n,r,s,u,"next",e)}function u(e){o(a,n,r,s,u,"throw",e)}s(void 0)})},function(){return s.apply(this,arguments)})},{key:"getWaveSurferAudioContext",value:function(){try{var e;return null!==(e=this.state.wavesurfer)&&void 0!==e&&null!==(e=e.backend)&&void 0!==e&&e.audioContext?this.state.wavesurfer.backend.audioContext:null}catch(e){return console.error("Error getting WaveSurfer AudioContext:",e),null}}},{key:"checkState",value:function(){var e=this.getWaveSurferAudioContext();return e?e.state:null}}],r&&a(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,r,i,s}(),u={WAVESURFER:{WAVE_COLOR:"#4F4A85",PROGRESS_COLOR:"#383351",CURSOR_COLOR:"#fff",BAR_WIDTH:2,BAR_RADIUS:3,CURSOR_WIDTH:1,BAR_GAP:3,SAMPLE_RATE:44100},TIMELINE:{MIN_TICK_PIXELS:100,NICE_STEPS:[.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600]},SPECTROGRAM:{FFT_SIZE:4096,NOVERLAP:2048,HEIGHT:250,SCALE_OPTIONS:[{value:"linear",label:"Linear"},{value:"mel",label:"Mel"},{value:"bark",label:"Bark"},{value:"erb",label:"ERB"}],DEFAULT_SCALE:"mel"},REGION:{MIN_DURATION:.1}};function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,g(r.key),r)}}function g(e){var t=function(e){if("object"!=l(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==l(t)?t:t+""}var v=function(){return t=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state=t},(n=[{key:"create",value:function(){return WaveSurfer.create({container:"#waveform",waveColor:u.WAVESURFER.WAVE_COLOR,progressColor:u.WAVESURFER.PROGRESS_COLOR,cursorColor:u.WAVESURFER.CURSOR_COLOR,barWidth:u.WAVESURFER.BAR_WIDTH,barRadius:u.WAVESURFER.BAR_RADIUS,cursorWidth:u.WAVESURFER.CURSOR_WIDTH,barGap:u.WAVESURFER.BAR_GAP,responsive:!0,sampleRate:u.WAVESURFER.SAMPLE_RATE,normalize:!0,backend:"WebAudio",autoplay:!1,mediaControls:!1,hideScrollbar:!1,interact:!0,plugins:[WaveSurfer.Hover.create({lineWidth:2,labelBackground:"#000000",labelColor:"#fff",formatTimeCallback:e.formatTime})]})}},{key:"getTimelineIntervals",value:function(e){if(!e||e<=0)return{timeInterval:1,primaryLabelInterval:5,secondaryLabelInterval:1};var t,n=document.getElementById("timeline"),r=((null==n?void 0:n.offsetWidth)||1e3)/e,o=u.TIMELINE.NICE_STEPS[u.TIMELINE.NICE_STEPS.length-1],a=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}(u.TIMELINE.NICE_STEPS);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(i*r>=u.TIMELINE.MIN_TICK_PIXELS){o=i;break}}}catch(e){a.e(e)}finally{a.f()}return{timeInterval:o,primaryLabelInterval:5*o,secondaryLabelInterval:o}}}])&&f(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}();function p(e){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p(e)}function d(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof s?r:s,l=Object.create(u.prototype);return y(l,"_invoke",function(n,r,o){var a,s,u,l=0,c=o||[],f=!1,g={p:0,n:0,v:e,a:v,f:v.bind(e,4),d:function(t,n){return a=t,s=0,u=e,g.n=n,i}};function v(n,r){for(s=n,u=r,t=0;!f&&l&&!o&&t<c.length;t++){var o,a=c[t],v=g.p,p=a[2];n>3?(o=p===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=v&&((o=n<2&&v<a[1])?(s=0,g.v=r,g.n=a[1]):v<p&&(o=n<3||a[0]>r||r>p)&&(a[4]=n,a[5]=r,g.n=p,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,c,p){if(l>1)throw TypeError("Generator is already running");for(f&&1===c&&v(c,p),s=c,u=p;(t=s<2?e:u)||!f;){a||(s?s<3?(s>1&&(g.n=-1),v(s,u)):g.n=u:g.v=u);try{if(l=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=g.n<0)?u:n.call(r,g))!==i)break}catch(t){a=e,s=1,u=t}finally{l=1}}return{value:t,done:f}}}(n,o,a),!0),l}var i={};function s(){}function u(){}function l(){}t=Object.getPrototypeOf;var c=[][r]?t(t([][r]())):(y(t={},r,function(){return this}),t),f=l.prototype=s.prototype=Object.create(c);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,y(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=l,y(f,"constructor",l),y(l,"constructor",u),u.displayName="GeneratorFunction",y(l,o,"GeneratorFunction"),y(f),y(f,o,"Generator"),y(f,r,function(){return this}),y(f,"toString",function(){return"[object Generator]"}),(d=function(){return{w:a,m:g}})()}function y(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}y=function(e,t,n,r){function a(t,n){y(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},y(e,t,n,r)}function m(e,t,n,r,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function h(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){m(a,r,o,i,s,"next",e)}function s(e){m(a,r,o,i,s,"throw",e)}i(void 0)})}}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,S(r.key),r)}}function S(e){var t=function(e){if("object"!=p(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=p(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==p(t)?t:t+""}var w=function(){return t=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state=t,this.waveSurferManager=n},n=[{key:"setupSpectrogram",value:(i=h(d().m(function t(){var n;return d().w(function(t){for(;;)switch(t.n){case 0:if(this.state.spectrogramPlugin)try{this.state.wavesurfer.unregisterPlugin(this.state.spectrogramPlugin),this.state.spectrogramPlugin=null}catch(e){console.warn("Error removing existing spectrogram plugin:",e)}(n=document.getElementById("spectrogram"))&&(n.innerHTML="");try{this.state.spectrogramPlugin=this.state.wavesurfer.registerPlugin(WaveSurfer.Spectrogram.create({container:"#spectrogram",labels:!0,scale:u.SPECTROGRAM.DEFAULT_SCALE,splitChannels:!1,fftSize:u.SPECTROGRAM.FFT_SIZE,noverlap:u.SPECTROGRAM.NOVERLAP,height:u.SPECTROGRAM.HEIGHT})),e.log("Spectrogram plugin registered successfully")}catch(e){console.warn("Failed to register spectrogram plugin:",e),this.state.spectrogramPlugin=null}case 1:return t.a(2)}},t,this)})),function(){return i.apply(this,arguments)})},{key:"changeSpectrogramScale",value:(a=h(d().m(function t(n){var r,o=this;return d().w(function(t){for(;;)switch(t.n){case 0:if(this.state.spectrogramPlugin){t.n=1;break}return console.warn("Spectrogram plugin not available"),t.a(2);case 1:try{this.state.wavesurfer.unregisterPlugin(this.state.spectrogramPlugin),this.state.spectrogramPlugin=null,(r=document.getElementById("spectrogram"))&&(r.innerHTML=""),this.state.spectrogramPlugin=this.state.wavesurfer.registerPlugin(WaveSurfer.Spectrogram.create({container:"#spectrogram",labels:!0,scale:n,splitChannels:!1,fftSize:u.SPECTROGRAM.FFT_SIZE,noverlap:u.SPECTROGRAM.NOVERLAP,height:u.SPECTROGRAM.HEIGHT})),setTimeout(function(){o.state.spectrogramPlugin&&o.state.spectrogramPlugin.render()},100),e.log("Spectrogram scale changed to: ".concat(n))}catch(e){console.warn("Failed to change spectrogram scale:",e)}case 2:return t.a(2)}},t,this)})),function(e){return a.apply(this,arguments)})},{key:"setupTimeline",value:(o=h(d().m(function t(){var n,r;return d().w(function(t){for(;;)switch(t.n){case 0:if(this.state.timelinePlugin)try{this.state.wavesurfer.unregisterPlugin(this.state.timelinePlugin),this.state.timelinePlugin=null}catch(e){console.warn("Error removing existing timeline plugin:",e)}(n=document.getElementById("timeline"))&&(n.innerHTML=""),r=this.waveSurferManager.getTimelineIntervals(this.state.wavesurfer.getDuration());try{this.state.timelinePlugin=this.state.wavesurfer.registerPlugin(WaveSurfer.Timeline.create({container:"#timeline",formatTimeCallback:e.formatTime,timeInterval:r.timeInterval,primaryLabelInterval:r.primaryLabelInterval,secondaryLabelInterval:r.secondaryLabelInterval})),e.log("Timeline plugin registered successfully")}catch(e){console.warn("Failed to register timeline plugin:",e),this.state.timelinePlugin=null}case 1:return t.a(2)}},t,this)})),function(){return o.apply(this,arguments)})},{key:"setupRegions",value:(r=h(d().m(function t(){var n;return d().w(function(t){for(;;)switch(t.p=t.n){case 0:t.p=0,this.state.regionsPlugin=this.state.wavesurfer.registerPlugin(WaveSurfer.Regions.create({})),e.log("Regions plugin registered successfully"),t.n=2;break;case 1:return t.p=1,n=t.v,console.warn("Failed to register regions plugin:",n),this.state.regionsPlugin=null,t.a(2);case 2:this.setupRegionEvents();case 3:return t.a(2)}},t,this,[[0,1]])})),function(){return r.apply(this,arguments)})},{key:"setupRegionEvents",value:function(){var e=this;this.state.regionsPlugin.enableDragSelection({color:"rgba(255, 0, 0, 0.1)"}),this.state.regionsPlugin.on("region-created",function(t){e.state.regionsPlugin.getRegions&&e.state.regionsPlugin.getRegions().forEach(function(e){e.id!==t.id&&e.remove()}),e.state.selectedRegionId=t.id,e.state.regionManager.showControls(),setTimeout(function(){e.state.regionManager.createOverlays(t)},100)}),this.state.regionsPlugin.on("region-clicked",function(t){e.state.selectedRegionId=t.id,e.state.regionManager.showControls(),e.state.regionManager.createOverlays(t)}),this.state.regionsPlugin.on("region-removed",function(t){e.state.selectedRegionId===t.id&&(e.state.selectedRegionId=null,e.state.regionManager.hideControls())}),this.state.regionsPlugin.on("region-updated",function(t){e.state.selectedRegionId===t.id&&e.state.regionManager.updateOverlays(t)}),this.setupRegionClickHandlers()}},{key:"setupRegionClickHandlers",value:function(){var e=this,t=function(){var t;if(null!==(t=e.state.regionsPlugin)&&void 0!==t&&t.getRegions){var n=e.state.regionsPlugin.getRegions();n&&Object.keys(n).length>0&&(Object.values(n).forEach(function(e){e.remove()}),e.state.selectedRegionId=null,e.state.regionManager.hideControls())}};document.getElementById("waveform").addEventListener("click",function(e){var n=e.target;n.closest(".wavesurfer-region")||n.closest(".region-input-overlay")||n.classList.contains("region-input-overlay")||n.classList.contains("region-start-input")||n.classList.contains("region-end-input")||t()});var n=document.getElementById("spectrogram");n&&n.addEventListener("click",t)}}],n&&b(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r,o,a,i}();function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,O(r.key),r)}}function O(e){var t=function(e){if("object"!=E(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==E(t)?t:t+""}var I=function(){return t=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state=t},n=[{key:"showControls",value:function(){this.state.elements.loopControls.style.display="flex"}},{key:"hideControls",value:function(){this.state.elements.loopControls.style.display="none",this.removeOverlays()}},{key:"createOverlays",value:function(e){this.removeOverlays();var t=document.getElementById("waveform"),n=t.getBoundingClientRect(),r=e.element;if(r){var o=r.getBoundingClientRect();this.state.regionStartOverlay=document.createElement("div"),this.state.regionStartOverlay.className="region-input-overlay",this.state.regionStartOverlay.innerHTML='\n            <input type="number" value="'.concat(e.start.toFixed(3),'" class="region-start-input" title="Start time">\n        '),this.state.regionEndOverlay=document.createElement("div"),this.state.regionEndOverlay.className="region-input-overlay",this.state.regionEndOverlay.innerHTML='\n            <input type="number" value="'.concat(e.end.toFixed(3),'" class="region-end-input" title="End time">\n        ');var a=o.left-n.left-10,i=o.right-n.left+10,s=o.top-n.top+10;this.state.regionStartOverlay.style.left=a+"px",this.state.regionStartOverlay.style.top=s+"px",this.state.regionEndOverlay.style.left=i+"px",this.state.regionEndOverlay.style.top=s+"px",t.appendChild(this.state.regionStartOverlay),t.appendChild(this.state.regionEndOverlay),this.setupOverlayEvents(e)}}},{key:"setupOverlayEvents",value:function(t){var n=this,r=this.state.regionStartOverlay.querySelector(".region-start-input"),o=this.state.regionEndOverlay.querySelector(".region-end-input"),a=function(r,o){if(console.log("applyRegionInput called with:",{startTimeInput:r,endTimeInput:o,region:t}),t&&n.state.wavesurfer){var a=n.state.wavesurfer.getDuration()||0,i=t.start,s=t.end,l=parseFloat(r),c=parseFloat(o);if(isNaN(l)||(i=l),isNaN(c)||(s=c),i>s){var f=i;i=s,s=f}i>a&&(i=Math.max(0,a-u.REGION.MIN_DURATION)),s>a&&(s=a),i=Math.max(0,i),s=Math.min(a,s),i+u.REGION.MIN_DURATION>s&&(s=Math.min(a,i+u.REGION.MIN_DURATION));try{if(n.state.regionsPlugin&&n.state.regionsPlugin.getRegions){var g=n.state.regionsPlugin.getRegions();Object.values(g).forEach(function(e){e.remove()})}if(n.state.regionsPlugin&&n.state.regionsPlugin.addRegion){var v=n.state.regionsPlugin.addRegion({start:i,end:s,color:"rgba(255, 0, 0, 0.1)"});n.state.selectedRegionId=v.id,setTimeout(function(){n.createOverlays(v)},100)}}catch(t){console.error("Failed to update region: ",t),e.showStatus("Failed to update region: "+t.message,n.state.elements.status)}}},i=function(e){var t=e.target.value,n=o.value;a(t,n)},s=function(e){var t=r.value,n=e.target.value;a(t,n)};r.addEventListener("change",i),r.addEventListener("keydown",function(e){"Enter"===e.key&&(e.target.blur(),i(e))}),o.addEventListener("change",s),o.addEventListener("keydown",function(e){"Enter"===e.key&&(e.target.blur(),s(e))})}},{key:"updateOverlays",value:function(e){if(this.state.regionStartOverlay&&this.state.regionEndOverlay){var t=this.state.regionStartOverlay.querySelector(".region-start-input"),n=this.state.regionEndOverlay.querySelector(".region-end-input");t.value=e.start.toFixed(3),n.value=e.end.toFixed(3)}}},{key:"removeOverlays",value:function(){this.state.regionStartOverlay&&(this.state.regionStartOverlay.remove(),this.state.regionStartOverlay=null),this.state.regionEndOverlay&&(this.state.regionEndOverlay.remove(),this.state.regionEndOverlay=null)}},{key:"getSelectedRegion",value:function(){var e;if(null===(e=this.state.regionsPlugin)||void 0===e||!e.getRegions)return null;var t=this.state.regionsPlugin.getRegions();if(!t||0===Object.keys(t).length)return null;if(this.state.selectedRegionId&&t[this.state.selectedRegionId])return t[this.state.selectedRegionId];var n=Object.keys(t);if(n.length>0){var r=t[n[n.length-1]];return this.state.selectedRegionId=r.id,r}return null}},{key:"clearAllRegions",value:function(){var e;if(this.state.wavesurfer&&this.state.isPlaying&&(this.state.wavesurfer.stop(),this.state.isPlaying=!1,this.state.elements.playPause&&(this.state.elements.playPause.textContent="▶️",this.state.elements.playPause.classList.remove("playing"))),null!==(e=this.state.regionsPlugin)&&void 0!==e&&e.getRegions){var t=this.state.regionsPlugin.getRegions();t&&Object.keys(t).length>0&&Object.values(t).forEach(function(e){e.remove()})}this.state.selectedRegionId=null,this.removeOverlays(),this.hideControls(),console.log("All regions cleared and audio stopped")}},{key:"clearRegionsFromDOM",value:function(){this.state.wavesurfer&&this.state.isPlaying&&(this.state.wavesurfer.stop(),this.state.isPlaying=!1,this.state.elements.playPause&&(this.state.elements.playPause.textContent="▶️",this.state.elements.playPause.classList.remove("playing")));var e=document.getElementById("waveform");e&&e.querySelectorAll(".wavesurfer-region").forEach(function(e){return e.remove()}),this.state.selectedRegionId=null,this.removeOverlays(),this.hideControls(),console.log("Regions cleared from DOM and audio stopped")}}],n&&P(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}();function C(e){return C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function R(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,s=[],u=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,o=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return M(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,T(r.key),r)}}function T(e){var t=function(e){if("object"!=C(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=C(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==C(t)?t:t+""}var A=function(){return e=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state=t,this.audioMetadata=n},t=[{key:"updateDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(e||(e=this.state.wavesurfer.getDuration()),e&&!isNaN(e)){var t=Math.floor(e/60),n=Math.floor(e%60);this.state.elements.durationInfo.textContent="".concat(t,":").concat(n.toString().padStart(2,"0"))}}},{key:"updateFileInfo",value:function(){try{var e=this.state.wavesurfer.getDecodedData(),t=this.audioMetadata.sampleRate||(null==e?void 0:e.sampleRate)||u.WAVESURFER.SAMPLE_RATE,n=this.audioMetadata.channels||(null==e?void 0:e.numberOfChannels)||2,r=this.audioMetadata.bitDepth||((null==e?void 0:e.length)>0?e instanceof Float32Array?32:16:"--"),o=this.audioMetadata.format||this.detectFormat(),a=this.audioMetadata.fileSize||(e?this.estimateFileSize(e):"--"),i=this.audioMetadata.duration||(e?e.length/t:"--");this.state.elements.sampleRateInfo.textContent=t?"".concat(t," Hz"):"--",this.state.elements.channelsInfo.textContent=n||"--",this.state.elements.bitDepthInfo.textContent="--"===r?"--":"".concat(r," bit"),this.state.elements.formatInfo.textContent=o||"--",this.state.elements.fileSizeInfo.textContent=a||"--",i&&"--"!==i?this.updateDuration(i):this.updateDuration(),this.state.elements.fileInfo.style.display="flex"}catch(e){console.warn("Error updating file info:",e)}}},{key:"estimateFileSize",value:function(e){if(!e)return"--";var t=e.length*e.numberOfChannels*2,n=Math.round(t/1024),r=(t/1048576).toFixed(1);return r>1?"".concat(r," MB"):"".concat(n," KB")}},{key:"detectFormat",value:function(){var e="{{audioSrc}}";if(!e.startsWith("data:")){var t,n=null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase();return{mp3:"MP3",wav:"WAV",flac:"FLAC",ogg:"OGG",aac:"AAC",webm:"WEBM"}[n]||(null==n?void 0:n.toUpperCase())||"Unknown"}var r=e.match(/data:([^;]+)/);if(r){for(var o,a=r[1],i=0,s=Object.entries({mpeg:"MP3",mp3:"MP3",wav:"WAV",flac:"FLAC",ogg:"OGG",aac:"AAC",webm:"WEBM"});i<s.length;i++){var u=R(s[i],2),l=u[0],c=u[1];if(a.includes(l))return c}return(null===(o=a.split("/")[1])||void 0===o?void 0:o.toUpperCase())||"Unknown"}return"Unknown"}}],t&&k(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function x(e){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},x(e)}function j(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof s?r:s,l=Object.create(u.prototype);return L(l,"_invoke",function(n,r,o){var a,s,u,l=0,c=o||[],f=!1,g={p:0,n:0,v:e,a:v,f:v.bind(e,4),d:function(t,n){return a=t,s=0,u=e,g.n=n,i}};function v(n,r){for(s=n,u=r,t=0;!f&&l&&!o&&t<c.length;t++){var o,a=c[t],v=g.p,p=a[2];n>3?(o=p===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=v&&((o=n<2&&v<a[1])?(s=0,g.v=r,g.n=a[1]):v<p&&(o=n<3||a[0]>r||r>p)&&(a[4]=n,a[5]=r,g.n=p,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,c,p){if(l>1)throw TypeError("Generator is already running");for(f&&1===c&&v(c,p),s=c,u=p;(t=s<2?e:u)||!f;){a||(s?s<3?(s>1&&(g.n=-1),v(s,u)):g.n=u:g.v=u);try{if(l=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=g.n<0)?u:n.call(r,g))!==i)break}catch(t){a=e,s=1,u=t}finally{l=1}}return{value:t,done:f}}}(n,o,a),!0),l}var i={};function s(){}function u(){}function l(){}t=Object.getPrototypeOf;var c=[][r]?t(t([][r]())):(L(t={},r,function(){return this}),t),f=l.prototype=s.prototype=Object.create(c);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,L(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=l,L(f,"constructor",l),L(l,"constructor",u),u.displayName="GeneratorFunction",L(l,o,"GeneratorFunction"),L(f),L(f,o,"Generator"),L(f,r,function(){return this}),L(f,"toString",function(){return"[object Generator]"}),(j=function(){return{w:a,m:g}})()}function L(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}L=function(e,t,n,r){function a(t,n){L(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},L(e,t,n,r)}function F(e,t,n,r,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function _(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){F(a,r,o,i,s,"next",e)}function s(e){F(a,r,o,i,s,"throw",e)}i(void 0)})}}function G(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,B(r.key),r)}}function B(e){var t=function(e){if("object"!=x(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=x(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==x(t)?t:t+""}var W=function(){return t=function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.state=t,this.audioContextManager=n,this.regionManager=r},n=[{key:"setupPlayPause",value:function(){var t=this;this.state.elements.playPause.addEventListener("click",_(j().m(function n(){var r,o,a;return j().w(function(n){for(;;)switch(n.p=n.n){case 0:if(console.log("Play/Pause button clicked, current state:",t.state.isPlaying),n.p=1,!t.state.isPlaying){n.n=2;break}t.state.wavesurfer.pause(),n.n=8;break;case 2:if(t.state.wavesurfer){n.n=3;break}return n.a(2);case 3:if(t.state.audioContextInitialized){n.n=4;break}return n.n=4,t.audioContextManager.initialize();case 4:if("suspended"!==(null==(r=t.audioContextManager.getWaveSurferAudioContext())?void 0:r.state)){n.n=5;break}return n.n=5,r.resume();case 5:if(!(o=t.regionManager.getSelectedRegion())){n.n=7;break}return n.n=6,t.state.wavesurfer.play(o.start,o.end);case 6:n.n=8;break;case 7:return n.n=8,t.state.wavesurfer.play();case 8:n.n=10;break;case 9:if(n.p=9,a=n.v,console.error("Playback error:",a),e.showStatus("Playback error: "+a.message,t.state.elements.status),!a.message.includes("AudioContext")&&!a.message.includes("suspended")){n.n=10;break}return t.state.audioContextInitialized=!1,n.n=10,t.audioContextManager.initialize();case 10:return n.a(2)}},n,null,[[1,9]])})))}},{key:"setupStop",value:function(){var e=this;this.state.elements.stop.addEventListener("click",function(){e.state.wavesurfer.stop()})}},{key:"setupVolume",value:function(){var e=this;this.state.elements.volume.addEventListener("input",function(t){var n=parseFloat(t.target.value);e.state.wavesurfer.setVolume(n)})}},{key:"setupLoop",value:function(){var e=this;this.state.elements.loopEnabled.addEventListener("change",function(t){e.state.loopEnabled=t.target.checked})}},{key:"setupSpectrogramScale",value:function(){var e=this;this.state.elements.spectrogramScale&&this.state.elements.spectrogramScale.addEventListener("change",function(){var t=_(j().m(function t(n){var r;return j().w(function(t){for(;;)switch(t.n){case 0:if(r=n.target.value,console.log("Spectrogram scale changed to:",r),!e.state.pluginManager){t.n=1;break}return t.n=1,e.state.pluginManager.changeSpectrogramScale(r);case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}())}},{key:"setupKeyboardEvents",value:function(){var t=this;document.addEventListener("keydown",function(){var n=_(j().m(function n(r){var o,a,i;return j().w(function(n){for(;;)switch(n.p=n.n){case 0:if("Space"!==r.code||r.target.matches("input, textarea")){n.n=9;break}if(console.log("Space key detected, triggering play/pause"),r.preventDefault(),t.state.audioContextInitialized){n.n=4;break}return n.p=1,n.n=2,t.audioContextManager.initialize();case 2:n.n=4;break;case 3:return n.p=3,a=n.v,console.error("AudioContext initialization failed on spacebar:",a),e.showStatus("AudioContext initialization failed: "+a.message,t.state.elements.status),n.a(2);case 4:if("suspended"!==(null==(o=t.audioContextManager.getWaveSurferAudioContext())?void 0:o.state)){n.n=8;break}return n.p=5,n.n=6,o.resume();case 6:n.n=8;break;case 7:return n.p=7,i=n.v,console.error("Failed to resume AudioContext on spacebar:",i),e.showStatus("Failed to resume AudioContext: "+i.message,t.state.elements.status),n.a(2);case 8:t.state.elements.playPause.click();case 9:return n.a(2)}},n,null,[[5,7],[1,3]])}));return function(e){return n.apply(this,arguments)}}())}},{key:"setupWaveSurferEvents",value:function(){var t=this;this.state.wavesurfer.on("play",function(){console.log("WaveSurfer play event triggered"),t.state.isPlaying=!0,t.state.elements.playPause.textContent="⏸️",t.state.elements.playPause.classList.add("playing"),console.log("Button text changed to pause icon")}),this.state.wavesurfer.on("pause",function(){console.log("WaveSurfer pause event triggered"),t.state.isPlaying=!1,t.state.elements.playPause.textContent="▶️",t.state.elements.playPause.classList.remove("playing"),console.log("Button text changed to play icon")}),this.state.wavesurfer.on("stop",function(){console.log("WaveSurfer stop event triggered"),t.state.isPlaying=!1,t.state.elements.playPause.textContent="▶️",t.state.elements.playPause.classList.remove("playing"),console.log("Button text changed to play icon")}),this.state.wavesurfer.on("finish",function(){if(t.state.loopEnabled){var e=t.regionManager.getSelectedRegion();e?setTimeout(function(){t.state.wavesurfer.play(e.start,e.end)},100):setTimeout(function(){t.state.wavesurfer.play()},100)}else t.state.isPlaying=!1,t.state.elements.playPause.textContent="▶️",t.state.elements.playPause.classList.remove("playing")});var n=null;this.state.wavesurfer.on("play",function(){t.state.loopEnabled&&(n=setInterval(function(){if(t.state.isPlaying&&t.state.loopEnabled){var e=t.state.wavesurfer.getCurrentTime(),n=t.regionManager.getSelectedRegion();n&&void 0!==n.start&&void 0!==n.end?e>=n.end-.1&&t.state.wavesurfer.play(n.start,n.end):e>=t.state.wavesurfer.getDuration()-.1&&t.state.wavesurfer.play()}},100))}),this.state.wavesurfer.on("pause",function(){n&&(clearInterval(n),n=null)}),this.state.wavesurfer.on("stop",function(){n&&(clearInterval(n),n=null)}),this.state.wavesurfer.on("error",function(n){e.showStatus("Error: "+n.message,t.state.elements.status),vscode.postMessage({command:"error",text:n.message})}),this.state.wavesurfer.on("ready",function(){setTimeout(function(){t.audioContextManager.checkState()},100)}),this.state.wavesurfer.on("decode",function(){setTimeout(function(){t.state.fileInfoManager.updateFileInfo()},100)})}}],n&&G(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n}();function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function D(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,a){var u=r&&r.prototype instanceof s?r:s,l=Object.create(u.prototype);return z(l,"_invoke",function(n,r,o){var a,s,u,l=0,c=o||[],f=!1,g={p:0,n:0,v:e,a:v,f:v.bind(e,4),d:function(t,n){return a=t,s=0,u=e,g.n=n,i}};function v(n,r){for(s=n,u=r,t=0;!f&&l&&!o&&t<c.length;t++){var o,a=c[t],v=g.p,p=a[2];n>3?(o=p===r)&&(u=a[(s=a[4])?5:(s=3,3)],a[4]=a[5]=e):a[0]<=v&&((o=n<2&&v<a[1])?(s=0,g.v=r,g.n=a[1]):v<p&&(o=n<3||a[0]>r||r>p)&&(a[4]=n,a[5]=r,g.n=p,s=0))}if(o||n>1)return i;throw f=!0,r}return function(o,c,p){if(l>1)throw TypeError("Generator is already running");for(f&&1===c&&v(c,p),s=c,u=p;(t=s<2?e:u)||!f;){a||(s?s<3?(s>1&&(g.n=-1),v(s,u)):g.n=u:g.v=u);try{if(l=2,a){if(s||(o="next"),t=a[o]){if(!(t=t.call(a,u)))throw TypeError("iterator result is not an object");if(!t.done)return t;u=t.value,s<2&&(s=0)}else 1===s&&(t=a.return)&&t.call(a),s<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),s=1);a=e}else if((t=(f=g.n<0)?u:n.call(r,g))!==i)break}catch(t){a=e,s=1,u=t}finally{l=1}}return{value:t,done:f}}}(n,o,a),!0),l}var i={};function s(){}function u(){}function l(){}t=Object.getPrototypeOf;var c=[][r]?t(t([][r]())):(z(t={},r,function(){return this}),t),f=l.prototype=s.prototype=Object.create(c);function g(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,z(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return u.prototype=l,z(f,"constructor",l),z(l,"constructor",u),u.displayName="GeneratorFunction",z(l,o,"GeneratorFunction"),z(f),z(f,o,"Generator"),z(f,r,function(){return this}),z(f,"toString",function(){return"[object Generator]"}),(D=function(){return{w:a,m:g}})()}function z(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}z=function(e,t,n,r){function a(t,n){z(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(a("next",0),a("throw",1),a("return",2))},z(e,t,n,r)}function U(e,t,n,r,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,o)}function V(e){return function(){var t=this,n=arguments;return new Promise(function(r,o){var a=e.apply(t,n);function i(e){U(a,r,o,i,s,"next",e)}function s(e){U(a,r,o,i,s,"throw",e)}i(void 0)})}}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,q(r.key),r)}}function q(e){var t=function(e){if("object"!=N(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=N(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==N(t)?t:t+""}var K=function(){return t=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.vscode=acquireVsCodeApi(),this.audioSrc="{{audioSrc}}",this.audioMetadata=function(){try{var e=document.getElementById("metadata-script");if(e&&e.textContent)return JSON.parse(e.textContent)}catch(e){console.warn("Error parsing metadata:",e)}return{}}(),this.state={wavesurfer:null,spectrogramPlugin:null,timelinePlugin:null,regionsPlugin:null,isPlaying:!1,loopEnabled:!1,isSetupComplete:!1,audioContextInitialized:!1,selectedRegionId:null,regionStartOverlay:null,regionEndOverlay:null,elements:{playPause:document.getElementById("playPause"),stop:document.getElementById("stop"),volume:document.getElementById("volume"),loopEnabled:document.getElementById("loopEnabled"),loopControls:document.getElementById("loopControls"),spectrogramScale:document.getElementById("spectrogramScale"),loading:document.getElementById("loading"),error:document.getElementById("error"),waveform:document.getElementById("waveform"),spectrogram:document.getElementById("spectrogram"),status:document.getElementById("status"),fileInfo:document.getElementById("fileInfo"),durationInfo:document.getElementById("durationInfo"),sampleRateInfo:document.getElementById("sampleRateInfo"),channelsInfo:document.getElementById("channelsInfo"),bitDepthInfo:document.getElementById("bitDepthInfo"),fileSizeInfo:document.getElementById("fileSizeInfo"),formatInfo:document.getElementById("formatInfo")}},this.audioContextManager=new s(this.state),this.waveSurferManager=new v(this.state),this.regionManager=new I(this.state),this.fileInfoManager=new A(this.state,this.audioMetadata),this.pluginManager=new w(this.state,this.waveSurferManager),this.eventManager=new W(this.state,this.audioContextManager,this.regionManager),this.state.audioContextManager=this.audioContextManager,this.state.regionManager=this.regionManager,this.state.fileInfoManager=this.fileInfoManager,this.state.pluginManager=this.pluginManager},n=[{key:"initAudioViewer",value:(r=V(D().m(function t(){var n,r,o,a=this;return D().w(function(t){for(;;)switch(t.n){case 0:try{e.log("Initializing audio viewer..."),e.log("Audio source length: "+this.audioSrc.length),this.regionManager.clearRegionsFromDOM(),this.state.wavesurfer=this.waveSurferManager.create(),n=function(){var t=V(D().m(function t(){var n;return D().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,a.state.isSetupComplete=!1,a.regionManager.clearAllRegions(),t.n=1,a.state.wavesurfer.load(a.audioSrc);case 1:return t.n=2,new Promise(function(e){return setTimeout(e,100)});case 2:a.audioContextManager.checkState(),t.n=4;break;case 3:throw t.p=3,n=t.v,console.error("Error loading audio:",n),e.showStatus("Error loading audio: "+n.message,a.state.elements.status),n;case 4:return t.a(2)}},t,null,[[0,3]])}));return function(){return t.apply(this,arguments)}}(),r=function(){var t=V(D().m(function t(){var r;return D().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,n();case 1:t.n=3;break;case 2:t.p=2,r=t.v,console.warn("Preload failed:",r),e.showStatus("Preload failed: "+r.message,a.state.elements.status),a.setupUserInteractionHandler();case 3:return t.a(2)}},t,null,[[0,2]])}));return function(){return t.apply(this,arguments)}}(),this.eventManager.setupKeyboardEvents(),r(),o=function(){var t=V(D().m(function t(){return D().w(function(t){for(;;)switch(t.n){case 0:if(!a.state.isSetupComplete){t.n=1;break}return t.a(2);case 1:return console.log("Setting up audio viewer after decode..."),a.state.isSetupComplete=!0,t.n=2,a.pluginManager.setupSpectrogram();case 2:return t.n=3,a.pluginManager.setupTimeline();case 3:return t.n=4,a.pluginManager.setupRegions();case 4:a.state.elements.loading.style.display="none",a.state.elements.waveform.style.display="block",a.state.elements.spectrogram.style.display="block",a.state.spectrogramPlugin&&setTimeout(function(){a.state.spectrogramPlugin.render()},100),console.log("Setting up event listeners..."),a.eventManager.setupPlayPause(),a.eventManager.setupStop(),a.eventManager.setupVolume(),a.eventManager.setupLoop(),a.eventManager.setupSpectrogramScale(),a.eventManager.setupWaveSurferEvents(),console.log("Event listeners setup complete"),a.fileInfoManager.updateDuration(),a.fileInfoManager.updateFileInfo(),setTimeout(function(){if(a.state.spectrogramPlugin)try{var t,n;e.log("Spectrogram frequency range check..."),e.log("Sample rate: "+((null===(t=a.state.wavesurfer.getDecodedData())||void 0===t?void 0:t.sampleRate)||"unknown")),e.log("FFT size: "+((null===(n=a.state.spectrogramPlugin.params)||void 0===n?void 0:n.fftSize)||"unknown"))}catch(e){console.warn("Error checking spectrogram frequency range:",e)}},1e3);case 5:return t.a(2)}},t)}));return function(){return t.apply(this,arguments)}}(),this.state.wavesurfer.on("decode",o)}catch(e){console.error("Error loading audio:",e),this.state.elements.loading.style.display="none",this.state.elements.error.style.display="block",this.state.elements.error.textContent="Error loading audio file: "+e.message,this.vscode.postMessage({command:"error",text:e.message}),"NotSupportedError"===e.name?this.state.elements.error.textContent+="\n\nThis audio format may not be supported by your browser.":"QuotaExceededError"===e.name&&(this.state.elements.error.textContent+="\n\nFile is too large. Try a smaller audio file.")}case 1:return t.a(2)}},t,this)})),function(){return r.apply(this,arguments)})},{key:"initialize",value:function(){this.regionManager.clearRegionsFromDOM(),this.regionManager.hideControls(),this.regionManager.clearAllRegions(),this.initAudioViewer(),this.vscode.postMessage({command:"log",text:"Audio viewer initialized"})}}],n&&H(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,n,r}();console.log("Audio viewer script loading..."),document.addEventListener("DOMContentLoaded",function(){console.log("DOM Content Loaded"),console.log("Initializing audio viewer..."),(new K).initialize()}),AudioViewer={}})();